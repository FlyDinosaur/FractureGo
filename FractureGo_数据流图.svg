<svg width="1400" height="1000" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .title { font-family: Arial, sans-serif; font-size: 24px; font-weight: bold; fill: #2c3e50; }
      .subtitle { font-family: Arial, sans-serif; font-size: 16px; font-weight: bold; fill: #34495e; }
      .text { font-family: Arial, sans-serif; font-size: 12px; fill: #2c3e50; }
      .small-text { font-family: Arial, sans-serif; font-size: 10px; fill: #7f8c8d; }
      .entity { fill: #3498db; stroke: #2980b9; stroke-width: 2; }
      .process { fill: #e74c3c; stroke: #c0392b; stroke-width: 2; }
      .datastore { fill: #f39c12; stroke: #e67e22; stroke-width: 2; }
      .external { fill: #9b59b6; stroke: #8e44ad; stroke-width: 2; }
      .flow { stroke: #34495e; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .flow-data { stroke: #27ae60; stroke-width: 1.5; fill: none; marker-end: url(#arrowhead-green); }
      .flow-control { stroke: #e67e22; stroke-width: 1.5; fill: none; marker-end: url(#arrowhead-orange); }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#34495e" />
    </marker>
    <marker id="arrowhead-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#27ae60" />
    </marker>
    <marker id="arrowhead-orange" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#e67e22" />
    </marker>
  </defs>
  
  <!-- 标题 -->
  <text x="700" y="30" text-anchor="middle" class="title">FractureGo 数据流图 (DFD)</text>
  <text x="700" y="55" text-anchor="middle" class="subtitle">康复训练应用系统架构</text>
  
  <!-- 图例 -->
  <g transform="translate(50, 80)">
    <text x="0" y="0" class="subtitle">图例:</text>
    <rect x="0" y="10" width="20" height="15" class="entity"/>
    <text x="25" y="22" class="small-text">外部实体</text>
    <rect x="100" y="10" width="20" height="15" class="process"/>
    <text x="125" y="22" class="small-text">处理过程</text>
    <rect x="200" y="10" width="20" height="15" class="datastore"/>
    <text x="225" y="22" class="small-text">数据存储</text>
    <rect x="300" y="10" width="20" height="15" class="external"/>
    <text x="325" y="22" class="small-text">外部服务</text>
  </g>
  
  <!-- 外部实体 -->
  <!-- 用户 -->
  <rect x="50" y="150" width="120" height="60" class="entity" rx="10"/>
  <text x="110" y="175" text-anchor="middle" class="text">用户</text>
  <text x="110" y="190" text-anchor="middle" class="small-text">(患者/医生/治疗师)</text>
  
  <!-- 微信平台 -->
  <rect x="50" y="250" width="120" height="60" class="external" rx="10"/>
  <text x="110" y="275" text-anchor="middle" class="text">微信平台</text>
  <text x="110" y="290" text-anchor="middle" class="small-text">(第三方登录)</text>
  
  <!-- MediaPipe -->
  <rect x="50" y="350" width="120" height="60" class="external" rx="10"/>
  <text x="110" y="375" text-anchor="middle" class="text">MediaPipe</text>
  <text x="110" y="390" text-anchor="middle" class="small-text">(AI模型)</text>
  
  <!-- 摄像头 -->
  <rect x="50" y="450" width="120" height="60" class="entity" rx="10"/>
  <text x="110" y="475" text-anchor="middle" class="text">摄像头</text>
  <text x="110" y="490" text-anchor="middle" class="small-text">(硬件设备)</text>
  
  <!-- iOS应用层 -->
  <g transform="translate(250, 120)">
    <rect x="0" y="0" width="400" height="400" fill="none" stroke="#3498db" stroke-width="2" stroke-dasharray="5,5" rx="10"/>
    <text x="200" y="20" text-anchor="middle" class="subtitle">iOS 应用层</text>
    
    <!-- 视图层 -->
    <rect x="20" y="40" width="100" height="50" class="process" rx="5"/>
    <text x="70" y="60" text-anchor="middle" class="text">视图层</text>
    <text x="70" y="75" text-anchor="middle" class="small-text">SwiftUI Views</text>
    
    <rect x="140" y="40" width="100" height="50" class="process" rx="5"/>
    <text x="190" y="60" text-anchor="middle" class="text">主界面</text>
    <text x="190" y="75" text-anchor="middle" class="small-text">MainView/HomeView</text>
    
    <rect x="260" y="40" width="100" height="50" class="process" rx="5"/>
    <text x="310" y="60" text-anchor="middle" class="text">训练界面</text>
    <text x="310" y="75" text-anchor="middle" class="small-text">HandLevelView等</text>
    
    <!-- 控制层 -->
    <rect x="20" y="110" width="100" height="50" class="process" rx="5"/>
    <text x="70" y="130" text-anchor="middle" class="text">用户管理</text>
    <text x="70" y="145" text-anchor="middle" class="small-text">UserManager</text>
    
    <rect x="140" y="110" width="100" height="50" class="process" rx="5"/>
    <text x="190" y="130" text-anchor="middle" class="text">摄像头管理</text>
    <text x="190" y="145" text-anchor="middle" class="small-text">CameraManager</text>
    
    <rect x="260" y="110" width="100" height="50" class="process" rx="5"/>
    <text x="310" y="130" text-anchor="middle" class="text">手势检测</text>
    <text x="310" y="145" text-anchor="middle" class="small-text">HandGestureDetector</text>
    
    <!-- 服务层 -->
    <rect x="20" y="180" width="100" height="50" class="process" rx="5"/>
    <text x="70" y="200" text-anchor="middle" class="text">网络服务</text>
    <text x="70" y="215" text-anchor="middle" class="small-text">NetworkService</text>
    
    <rect x="140" y="180" width="100" height="50" class="process" rx="5"/>
    <text x="190" y="200" text-anchor="middle" class="text">帖子服务</text>
    <text x="190" y="215" text-anchor="middle" class="small-text">PostService</text>
    
    <rect x="260" y="180" width="100" height="50" class="process" rx="5"/>
    <text x="310" y="200" text-anchor="middle" class="text">ML服务</text>
    <text x="310" y="215" text-anchor="middle" class="small-text">MediaPipeService</text>
    
    <!-- 数据层 -->
    <rect x="20" y="250" width="100" height="50" class="datastore" rx="5"/>
    <text x="70" y="270" text-anchor="middle" class="text">本地存储</text>
    <text x="70" y="285" text-anchor="middle" class="small-text">UserDefaults</text>
    
    <rect x="140" y="250" width="100" height="50" class="datastore" rx="5"/>
    <text x="190" y="270" text-anchor="middle" class="text">Core Data</text>
    <text x="190" y="285" text-anchor="middle" class="small-text">本地数据库</text>
    
    <rect x="260" y="250" width="100" height="50" class="datastore" rx="5"/>
    <text x="310" y="270" text-anchor="middle" class="text">配置管理</text>
    <text x="310" y="285" text-anchor="middle" class="small-text">DatabaseConfig</text>
    
    <!-- 模型文件 -->
    <rect x="80" y="320" width="120" height="50" class="datastore" rx="5"/>
    <text x="140" y="340" text-anchor="middle" class="text">ML模型文件</text>
    <text x="140" y="355" text-anchor="middle" class="small-text">hand_landmarker.task</text>
    
    <rect x="220" y="320" width="120" height="50" class="datastore" rx="5"/>
    <text x="280" y="340" text-anchor="middle" class="text">姿势模型</text>
    <text x="280" y="355" text-anchor="middle" class="small-text">pose_landmarker.task</text>
  </g>
  
  <!-- 服务器层 -->
  <g transform="translate(750, 120)">
    <rect x="0" y="0" width="400" height="400" fill="none" stroke="#e74c3c" stroke-width="2" stroke-dasharray="5,5" rx="10"/>
    <text x="200" y="20" text-anchor="middle" class="subtitle">Node.js 服务器层</text>
    
    <!-- API网关 -->
    <rect x="150" y="40" width="100" height="50" class="process" rx="5"/>
    <text x="200" y="60" text-anchor="middle" class="text">API网关</text>
    <text x="200" y="75" text-anchor="middle" class="small-text">Express Router</text>
    
    <!-- 中间件层 -->
    <rect x="20" y="110" width="80" height="40" class="process" rx="5"/>
    <text x="60" y="125" text-anchor="middle" class="small-text">认证中间件</text>
    <text x="60" y="140" text-anchor="middle" class="small-text">auth.js</text>
    
    <rect x="110" y="110" width="80" height="40" class="process" rx="5"/>
    <text x="150" y="125" text-anchor="middle" class="small-text">安全中间件</text>
    <text x="150" y="140" text-anchor="middle" class="small-text">security.js</text>
    
    <rect x="200" y="110" width="80" height="40" class="process" rx="5"/>
    <text x="240" y="125" text-anchor="middle" class="small-text">上传中间件</text>
    <text x="240" y="140" text-anchor="middle" class="small-text">upload.js</text>
    
    <rect x="290" y="110" width="80" height="40" class="process" rx="5"/>
    <text x="330" y="125" text-anchor="middle" class="small-text">图片优化</text>
    <text x="330" y="140" text-anchor="middle" class="small-text">imageOptimization</text>
    
    <!-- 控制器层 -->
    <rect x="20" y="170" width="80" height="40" class="process" rx="5"/>
    <text x="60" y="185" text-anchor="middle" class="small-text">用户控制器</text>
    <text x="60" y="200" text-anchor="middle" class="small-text">userController</text>
    
    <rect x="110" y="170" width="80" height="40" class="process" rx="5"/>
    <text x="150" y="185" text-anchor="middle" class="small-text">训练控制器</text>
    <text x="150" y="200" text-anchor="middle" class="small-text">trainingController</text>
    
    <rect x="200" y="170" width="80" height="40" class="process" rx="5"/>
    <text x="240" y="185" text-anchor="middle" class="small-text">帖子控制器</text>
    <text x="240" y="200" text-anchor="middle" class="small-text">postController</text>
    
    <rect x="290" y="170" width="80" height="40" class="process" rx="5"/>
    <text x="330" y="185" text-anchor="middle" class="small-text">签到控制器</text>
    <text x="330" y="200" text-anchor="middle" class="small-text">signInController</text>
    
    <!-- 数据库连接层 -->
    <rect x="150" y="230" width="100" height="50" class="process" rx="5"/>
    <text x="200" y="250" text-anchor="middle" class="text">数据库连接</text>
    <text x="200" y="265" text-anchor="middle" class="small-text">database.js</text>
    
    <!-- 文件存储 -->
    <rect x="50" y="300" width="100" height="50" class="datastore" rx="5"/>
    <text x="100" y="320" text-anchor="middle" class="text">文件存储</text>
    <text x="100" y="335" text-anchor="middle" class="small-text">uploads/</text>
    
    <rect x="250" y="300" width="100" height="50" class="datastore" rx="5"/>
    <text x="300" y="320" text-anchor="middle" class="text">日志文件</text>
    <text x="300" y="335" text-anchor="middle" class="small-text">logs/</text>
  </g>
  
  <!-- 数据库层 -->
  <rect x="800" y="600" width="300" height="150" class="datastore" rx="10"/>
  <text x="950" y="630" text-anchor="middle" class="subtitle">MySQL 数据库</text>
  
  <rect x="820" y="650" width="80" height="30" fill="#f8c471" stroke="#f39c12" rx="3"/>
  <text x="860" y="670" text-anchor="middle" class="small-text">users</text>
  
  <rect x="910" y="650" width="80" height="30" fill="#f8c471" stroke="#f39c12" rx="3"/>
  <text x="950" y="670" text-anchor="middle" class="small-text">user_progress</text>
  
  <rect x="1000" y="650" width="80" height="30" fill="#f8c471" stroke="#f39c12" rx="3"/>
  <text x="1040" y="670" text-anchor="middle" class="small-text">training_records</text>
  
  <rect x="820" y="690" width="80" height="30" fill="#f8c471" stroke="#f39c12" rx="3"/>
  <text x="860" y="710" text-anchor="middle" class="small-text">posts</text>
  
  <rect x="910" y="690" width="80" height="30" fill="#f8c471" stroke="#f39c12" rx="3"/>
  <text x="950" y="710" text-anchor="middle" class="small-text">sign_in_records</text>
  
  <rect x="1000" y="690" width="80" height="30" fill="#f8c471" stroke="#f39c12" rx="3"/>
  <text x="1040" y="710" text-anchor="middle" class="small-text">categories</text>
  
  <!-- 数据流箭头 -->
  <!-- 用户到应用 -->
  <line x1="170" y1="180" x2="250" y2="180" class="flow"/>
  <text x="210" y="175" text-anchor="middle" class="small-text">用户操作</text>
  
  <!-- 微信到应用 -->
  <line x1="170" y1="280" x2="250" y2="200" class="flow-control"/>
  <text x="210" y="240" text-anchor="middle" class="small-text">微信登录</text>
  
  <!-- 摄像头到应用 -->
  <line x1="170" y1="480" x2="390" y2="270" class="flow-data"/>
  <text x="280" y="375" text-anchor="middle" class="small-text">视频流</text>
  
  <!-- MediaPipe到应用 -->
  <line x1="170" y1="380" x2="510" y2="305" class="flow-control"/>
  <text x="340" y="340" text-anchor="middle" class="small-text">AI识别</text>
  
  <!-- 应用到服务器 -->
  <line x1="650" y1="300" x2="750" y2="200" class="flow"/>
  <text x="700" y="250" text-anchor="middle" class="small-text">HTTP API</text>
  
  <!-- 服务器到数据库 -->
  <line x1="950" y1="520" x2="950" y2="600" class="flow"/>
  <text x="980" y="560" text-anchor="middle" class="small-text">SQL查询</text>
  
  <!-- 内部数据流 -->
  <!-- 应用内部 -->
  <line x1="320" y1="160" x2="320" y2="180" class="flow-data"/>
  <line x1="440" y1="160" x2="440" y2="180" class="flow-data"/>
  <line x1="320" y1="230" x2="320" y2="250" class="flow-data"/>
  <line x1="440" y1="230" x2="440" y2="250" class="flow-data"/>
  
  <!-- 服务器内部 -->
  <line x1="950" y1="160" x2="950" y2="170" class="flow-control"/>
  <line x1="950" y1="210" x2="950" y2="230" class="flow-control"/>
  <line x1="950" y1="280" x2="950" y2="300" class="flow-data"/>
  
  <!-- 数据流标注 -->
  <g transform="translate(50, 850)">
    <text x="0" y="0" class="subtitle">主要数据流:</text>
    <text x="0" y="20" class="text">1. 用户认证流: 用户 → 登录界面 → UserManager → NetworkService → 服务器 → 数据库</text>
    <text x="0" y="40" class="text">2. 训练数据流: 摄像头 → CameraManager → HandGestureDetector → MediaPipe → 训练记录 → 服务器</text>
    <text x="0" y="60" class="text">3. 社区数据流: 用户 → ShareView → PostService → NetworkService → 服务器 → 帖子数据库</text>
    <text x="0" y="80" class="text">4. 配置数据流: DatabaseConfig → NetworkService → API网关 → 控制器 → 数据库连接</text>
    <text x="0" y="100" class="text">5. 文件上传流: 用户 → 上传界面 → 上传中间件 → 图片优化 → 文件存储</text>
  </g>
  
  <!-- 外部实体标注 -->
  <g transform="translate(1200, 150)">
    <text x="0" y="0" class="subtitle">外部实体:</text>
    <text x="0" y="20" class="text">• 用户: 患者、医生、治疗师</text>
    <text x="0" y="40" class="text">• 微信平台: 第三方登录服务</text>
    <text x="0" y="60" class="text">• MediaPipe: Google AI模型</text>
    <text x="0" y="80" class="text">• 摄像头: iOS设备硬件</text>
  </g>
  
  <!-- 加工过程标注 -->
  <g transform="translate(1200, 280)">
    <text x="0" y="0" class="subtitle">主要加工过程:</text>
    <text x="0" y="20" class="text">• 用户认证与授权</text>
    <text x="0" y="40" class="text">• 手势识别与分析</text>
    <text x="0" y="60" class="text">• 训练数据处理</text>
    <text x="0" y="80" class="text">• 社区内容管理</text>
    <text x="0" y="100" class="text">• 文件上传与优化</text>
    <text x="0" y="120" class="text">• 数据持久化</text>
  </g>
  
  <!-- 数据存储标注 -->
  <g transform="translate(1200, 450)">
    <text x="0" y="0" class="subtitle">数据存储:</text>
    <text x="0" y="20" class="text">• 本地: UserDefaults, Core Data</text>
    <text x="0" y="40" class="text">• 服务器: MySQL数据库</text>
    <text x="0" y="60" class="text">• 文件: 上传的图片和视频</text>
    <text x="0" y="80" class="text">• 模型: ML模型文件</text>
    <text x="0" y="100" class="text">• 配置: 应用配置信息</text>
  </g>
</svg>